<!DOCTYPE html>
<html>
<head>
  <title>Listener</title>
</head>
<body>
  <h1>üëÇ Listening Live Audio</h1>
  <p id="status">Connecting...</p>

  <script>
    const socket = new WebSocket("wss://voice-stream-server2.onrender.com");
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    let firstChunk = null;

    socket.onopen = () => {
      document.getElementById("status").innerText = "üîä Connected. Waiting for audio...";
    };

    socket.onmessage = async (event) => {
      const blob = event.data instanceof Blob ? event.data : new Blob([event.data]);
      const arrayBuffer = await blob.arrayBuffer();

      try {
        const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
        const source = audioContext.createBufferSource();
        source.buffer = audioBuffer;
        source.connect(audioContext.destination);
        source.start();
      } catch (err) {
        console.error("‚ö†Ô∏è Audio decode error:", err);
      }
    };
  </script>
</body>
</html>
