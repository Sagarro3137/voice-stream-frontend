<script>
  const ws = new WebSocket("wss://voice-stream-server2.onrender.com");
  let recorder, stream;

  ws.onopen = () => {
    console.log("✅ WebSocket connected");
  };

  ws.onerror = (e) => console.error("❌ WS error", e);

  document.getElementById("startBtn").onclick = async () => {
    try {
      stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      recorder = new MediaRecorder(stream);

      recorder.ondataavailable = e => {
        if (e.data.size > 0 && ws.readyState === 1) {
          ws.send(e.data);
          console.log("📤 Sending audio chunk", e.data);
        }
      };

      recorder.start(200);
      console.log("🎤 Recording started");
    } catch (err) {
      console.error("🎙️ Mic permission denied", err);
    }
  };
</script>
