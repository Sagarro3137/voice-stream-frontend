<!DOCTYPE html>
<html>
<head><title>Mic Broadcast</title></head>
<body>
  <h1>Broadcast Your Voice</h1>
  <button id="startBtn">Start Broadcasting</button>
  <p id="status">Status: Idle</p>
  <script>
    const ws = new WebSocket('wss://voice-stream-server2.onrender.com/signal');
    const pc = new RTCPeerConnection();
    document.getElementById('startBtn').onclick = async () => {
      document.getElementById('status').innerText = 'Status: Broadcasting';
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      stream.getTracks().forEach(t => pc.addTrack(t, stream));
      pc.onicecandidate = e => e.candidate && ws.send(JSON.stringify({ type:'ice-candidate', candidate: e.candidate }));
      ws.send(JSON.stringify({ type: 'broadcaster' }));
      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      ws.send(JSON.stringify({ type: 'offer', sdp: offer }));
    };
    ws.onmessage = async e => {
      const msg = JSON.parse(e.data);
      if (msg.type === 'answer') await pc.setRemoteDescription(new RTCSessionDescription(msg.sdp));
      if (msg.type === 'ice-candidate') await pc.addIceCandidate(msg.candidate);
    };
  </script>
</body>
</html>
