<!DOCTYPE html>
<html>
<head>
  <title>Mic Broadcasting</title>
</head>
<body>
  <h1>🎙️ You are Broadcasting</h1>
  <button id="start">Start Broadcast</button>
  <button id="stop">Stop Broadcast</button>

  <script>
    let mediaRecorder;
    const socket = new WebSocket("wss://voice-stream-server2.onrender.com");

    socket.onopen = () => console.log("✅ Connected to server");

    document.getElementById("start").onclick = async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);

      mediaRecorder.ondataavailable = (e) => {
        if (e.data.size > 0 && socket.readyState === WebSocket.OPEN) {
          socket.send(e.data);
        }
      };

      mediaRecorder.start(250); // send chunks every 250ms
    };

    document.getElementById("stop").onclick = () => {
      mediaRecorder?.stop();
    };
  </script>
</body>
</html>
